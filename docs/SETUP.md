# Руководство по установке и настройке

## Требования

- **Node.js** >= 18.0.0
- **Python** >= 3.10
- **npm** или **yarn**
- Аккаунт **Яндекс.Музыки** с активной подпиской

## Установка

### 1. Клонирование репозитория

```bash
cd /home/urch/Projects/yandex_downloads
```

### 2. Настройка Backend

```bash
cd backend

# Создание виртуального окружения
python -m venv venv

# Активация виртуального окружения
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows

# Установка зависимостей
pip install -r requirements.txt

# Копирование файла с настройками
cp env.example .env

# Редактирование настроек
nano .env  # или используйте любой другой редактор
```

### 3. Настройка Frontend

```bash
cd ../frontend

# Установка зависимостей
npm install

# Или с yarn
yarn install
```

## Получение токена Яндекс.Музыки

Для работы приложения необходим токен авторизации Яндекс.Музыки.

### Способ 1: Через браузер (рекомендуется)

1. Откройте браузер в режиме разработчика (F12)
2. Перейдите на вкладку Network/Сеть
3. Откройте сайт https://music.yandex.ru и авторизуйтесь
4. В списке запросов найдите любой запрос к API (например, к `/users/`)
5. Посмотрите заголовки запроса и найдите `Authorization`
6. Скопируйте значение токена (начинается с `OAuth`)

### Способ 2: Через cookies

1. После авторизации на music.yandex.ru
2. Откройте DevTools → Application → Cookies
3. Найдите cookie с именем `access_token` или `Session_id`
4. Скопируйте значение

### Вставка токена в настройки

Откройте файл `backend/.env` и вставьте токен:

```env
YANDEX_TOKEN=y0_AgAAAA...ваш_токен
```

## Настройка путей и качества

Отредактируйте файл `backend/.env`:

```env
# Путь для сохранения музыки
DOWNLOAD_PATH=/home/urch/Music/Yandex

# Качество по умолчанию
# lossless - FLAC максимального качества (рекомендуется для вашей аппаратуры)
# hq - высокое качество AAC/MP3 320kbps
# nq - нормальное качество MP3 192kbps
DEFAULT_QUALITY=lossless
```

## Запуск приложения

### Backend сервер

```bash
cd backend
source venv/bin/activate  # активируйте виртуальное окружение
python main.py

# Или через uvicorn
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

Сервер будет доступен по адресу: http://localhost:8000

API документация: http://localhost:8000/docs

### Frontend приложение

```bash
cd frontend
npm run dev

# Или с yarn
yarn dev
```

Приложение будет доступно по адресу: http://localhost:3000

## Первый запуск

1. Откройте браузер и перейдите на http://localhost:3000
2. Перейдите в раздел "Настройки"
3. Введите токен Яндекс.Музыки
4. Нажмите "Проверить" для проверки подключения
5. Настройте путь для сохранения файлов
6. Выберите качество аудио (рекомендуется "Максимальное")
7. Сохраните настройки
8. Перейдите в раздел "Плейлисты"
9. Нажмите "Обновить" для загрузки списка плейлистов
10. Выберите нужные плейлисты и нажмите "Синхронизировать"

## Рекомендации для аудиофильского качества

Для вашей аппаратуры (ЦАП Breeze audio, усилитель Cambridge Audio, омниканальная акустика):

1. **Всегда выбирайте качество "lossless"** - это даст FLAC файлы с максимальным битрейтом
2. **Создайте отдельную папку** для музыки на быстром SSD диске
3. **Организуйте файлы** по исполнителям и альбомам (приложение делает это автоматически)
4. **Регулярно синхронизируйте** плейлисты для получения новых треков

## Структура файлов

По умолчанию файлы сохраняются в следующей структуре:

```
/home/urch/Music/Yandex/
├── Queen/
│   └── A Night at the Opera/
│       └── Queen - Bohemian Rhapsody.flac
├── Pink Floyd/
│   └── The Wall/
│       └── Pink Floyd - Comfortably Numb.flac
└── ...
```

## Устранение неполадок

### Backend не запускается

- Убедитесь, что виртуальное окружение активировано
- Проверьте, что все зависимости установлены: `pip install -r requirements.txt`
- Проверьте логи на наличие ошибок

### Frontend не подключается к Backend

- Убедитесь, что Backend запущен на порту 8000
- Проверьте настройки CORS в `backend/main.py`
- Проверьте настройки proxy в `frontend/vite.config.ts`

### Ошибка авторизации

- Проверьте правильность токена
- Токен мог устареть - получите новый
- Убедитесь, что у вас активная подписка Яндекс.Музыки

### Не скачиваются треки

- Проверьте права доступа к папке для сохранения
- Убедитесь, что на диске достаточно свободного места
- Некоторые треки могут быть недоступны в вашем регионе

## Обновление

```bash
# Backend
cd backend
source venv/bin/activate
pip install --upgrade -r requirements.txt

# Frontend
cd frontend
npm update
# или
yarn upgrade
```

## Автоматический запуск (опционально)

Для автоматического запуска при старте системы можно создать systemd службы (Linux) или использовать PM2 для Node.js приложений.

Примеры конфигураций будут добавлены позже.

