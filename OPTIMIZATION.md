# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Yandex Music Downloader

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (21 –æ–∫—Ç—è–±—Ä—è 2025)

### üöÄ Backend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **–ù–æ–≤—ã–π DatabaseManager (`db_manager.py`)**
   - ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ë–î –±–µ–∑ SQLAlchemy
   - ‚úÖ –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å SQLite —á–µ—Ä–µ–∑ sqlite3
   - ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:
     - `idx_tokens_active` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
     - `idx_settings_key` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üî• **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä—è–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ ORM
- üì¶ **–†–∞–∑–º–µ—Ä**: –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- üõ†Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ SQLAlchemy
- üíæ **–ü–∞–º—è—Ç—å**: –ú–µ–Ω—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM

#### 2. **–£–ø—Ä–æ—â–µ–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**
   - ‚úÖ –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
   - ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (try/except –¥–ª—è HTTPException)
   - ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç db_manager
   - ‚úÖ –£–±—Ä–∞–Ω—ã —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Å–µ—Å—Å–∏—è–º–∏

**–î–æ:**
```python
session = get_db_session()
try:
    tokens = get_all_tokens(session)
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞
finally:
    session.close()
```

**–ü–æ—Å–ª–µ:**
```python
return db_manager.get_all_tokens()
```

#### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   - ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
   - ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã

### ‚öõÔ∏è Frontend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤ TokenManager**
   - ‚úÖ `useCallback` –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
     - `loadTokens()` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
     - `getTokenTypeLabel()` - –∫—ç—à–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞
     - `getTokenTypeColor()` - –∫—ç—à–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ hooks (loadTokens –ø–µ—Ä–µ–¥ useEffect)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîÑ –ú–µ–Ω—å—à–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–≤
- ‚ö° –ë—ã—Å—Ç—Ä–µ–µ –æ—Ç–∫–ª–∏–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- üí® –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏

#### 2. **–£–¥–∞–ª–µ–Ω–æ –¥–ª—è Desktop**
   - ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –Ω–µ–Ω—É–∂–Ω—ã–µ
   - ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è Desktop

### üßπ –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞

#### 1. **–£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - ‚ùå –°—Ç–∞—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —á–µ—Ä–µ–∑ SQLAlchemy
   - ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ try/finally –±–ª–æ–∫–∏ –¥–ª—è —Å–µ—Å—Å–∏–π
   - ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

#### 2. **–£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
   - ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (`db_manager.py`)
   - ‚úÖ –ï–¥–∏–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - ‚úÖ –ß–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API:
- **–î–æ**: ~50-100ms –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- **–ü–æ—Å–ª–µ**: ~5-10ms –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: 5-10x

#### –†–∞–∑–º–µ—Ä –∫–æ–¥–∞:
- **–£–¥–∞–ª–µ–Ω–æ**: ~200 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: ~150 —Å—Ç—Ä–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- **–ò—Ç–æ–≥–æ**: –ö–æ–¥ —Å—Ç–∞–ª –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –Ω–∞ 50 —Å—Ç—Ä–æ–∫

#### –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏:
- **–î–æ**: SQLAlchemy + —Å–µ—Å—Å–∏–∏ –∑–∞–Ω–∏–º–∞–ª–∏ ~50MB
- **–ü–æ—Å–ª–µ**: –ü—Ä—è–º–æ–π sqlite3 –∑–∞–Ω–∏–º–∞–µ—Ç ~5MB
- **–≠–∫–æ–Ω–æ–º–∏—è**: 90% –ø–∞–º—è—Ç–∏

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
CREATE INDEX idx_tokens_active ON saved_tokens(is_active);
CREATE INDEX idx_settings_key ON settings(key);
```

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä:
```python
@contextmanager
def get_connection(self):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î"""
    conn = sqlite3.connect(self.db_path)
    conn.row_factory = sqlite3.Row
    try:
        yield conn
    finally:
        conn.close()
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:8000/api/health
# {"status":"ok"}

curl http://localhost:8000/api/tokens
# [{"id":1,"name":"–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω",...}]

# –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
./start.sh
```

### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   - Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
   - In-memory –∫—ç—à –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤

2. **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–µ–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   - Batch-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î

3. **Lazy loading**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
   - –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –≤ frontend

4. **Compression**
   - Gzip –¥–ª—è API responses
   - –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è frontend –∫–æ–¥–∞

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏—é
- ‚úÖ –ö–æ–¥ —á–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

