<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–∞—É–∑—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }

        .paused {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .active {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
        }

        button:hover {
            background-color: #0056b3;
        }

        button.pause {
            background-color: #ffc107;
        }

        button.pause:hover {
            background-color: #e0a800;
        }

        button.resume {
            background-color: #28a745;
        }

        button.resume:hover {
            background-color: #1e7e34;
        }

        .info {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }

        .timestamp {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>‚è∏Ô∏è –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–∞—É–∑—ã –∑–∞–≥—Ä—É–∑–∫–∏</h1>

        <div class="status" id="status">
            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>

        <div class="info">
            <h3>üìä –¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã —Ç—Ä–µ–∫–æ–≤:</h3>
            <div id="stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div>
            <button id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
            <button onclick="updateStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        </div>

        <div class="timestamp" id="lastUpdate">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞
        </div>
    </div>

    <script>
        let isPaused = false;

        async function updateStatus() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã —Ç—Ä–µ–∫–æ–≤
                const statsResponse = await fetch('http://localhost:8000/api/debug/queue', {
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    document.getElementById('stats').innerHTML = `
                        <strong>–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤:</strong> ${statsData.total_tracks}<br>
                        <strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> ${statsData.status_counts.completed || 0}<br>
                        <strong>–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:</strong> ${statsData.status_counts.downloading || 0}<br>
                        <strong>–í –æ–∂–∏–¥–∞–Ω–∏–∏:</strong> ${statsData.status_counts.pending || 0}<br>
                        <strong>–û—à–∏–±–∫–∏:</strong> ${statsData.status_counts.error || 0}<br>
                        <strong>–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:</strong> ${statsData.status_counts.queued || 0}
                    `;
                }

                // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞—É–∑—ã
                const settingsResponse = await fetch('http://localhost:8000/api/settings', {
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (settingsResponse.ok) {
                    const settingsData = await settingsResponse.json();
                    isPaused = settingsData.downloads_paused;

                    const statusElement = document.getElementById('status');
                    const statusText = document.getElementById('statusText');
                    const pauseBtn = document.getElementById('pauseBtn');

                    if (isPaused) {
                        statusText.textContent = '‚è∏Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
                        statusElement.className = 'status paused';
                        pauseBtn.textContent = '‚ñ∂Ô∏è –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É';
                        pauseBtn.className = 'resume';
                    } else {
                        statusText.textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
                        statusElement.className = 'status active';
                        pauseBtn.textContent = '‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É';
                        pauseBtn.className = 'pause';
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                document.getElementById('lastUpdate').textContent =
                    `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('statusText').textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                document.getElementById('status').className = 'status';
            }
        }

        async function togglePause() {
            try {
                const response = await fetch('http://localhost:8000/api/downloads/pause', {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ paused: !isPaused })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data.message);
                    await updateStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞—É–∑—ã:', response.status);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        updateStatus();

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(updateStatus, 5000);
    </script>
</body>

</html>