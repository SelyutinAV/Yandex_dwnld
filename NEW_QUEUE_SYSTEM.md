# üéµ –ù–æ–≤–∞—è –°–∏—Å—Ç–µ–º–∞ –û—á–µ—Ä–µ–¥–∏ –ó–∞–≥—Ä—É–∑–æ–∫

## ‚úÖ –ß—Ç–æ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–ü–æ—à—Ç—É—á–Ω–∞—è –ó–∞–≥—Ä—É–∑–∫–∞ –¢—Ä–µ–∫–æ–≤**
- –¢—Ä–µ–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
- –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤–∏–¥–µ–Ω —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ FLAC**
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ lossless –∫–∞—á–µ—Å—Ç–≤–µ (FLAC)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (AES-128-CTR)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π FLAC —á–µ—Ä–µ–∑ FFmpeg
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π API —Å HMAC –ø–æ–¥–ø–∏—Å—å—é

### 3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û—á–µ—Ä–µ–¥—å—é**
- ‚ñ∂Ô∏è **–ó–∞–ø—É—Å–∫** –∑–∞–≥—Ä—É–∑–∫–∏
- ‚è∏Ô∏è **–ü–∞—É–∑–∞** –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- ‚ñ∂Ô∏è **–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚èπÔ∏è **–û—Å—Ç–∞–Ω–æ–≤–∫–∞** –ø—Ä–æ—Ü–µ—Å—Å–∞
- üóëÔ∏è **–û—á–∏—Å—Ç–∫–∞** –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

### 4. **–°—Ç–∞—Ç—É—Å—ã –¢—Ä–µ–∫–æ–≤**
- `pending` - –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏
- `downloading` - —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Å–µ–π—á–∞—Å
- `completed` - —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω
- `error` - –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- `paused` - –Ω–∞ –ø–∞—É–∑–µ

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û—á–µ—Ä–µ–¥—å—é

#### –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏
```bash
POST /api/queue/add-tracks
Content-Type: application/json

{
  "tracks": [
    {"id": "68160955", "title": "Afrika", "artist": "Morandi", "album": "N.O.W."}
  ],
  "quality": "lossless"  # –∏–ª–∏ "hq", "nq"
}
```

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—á–µ—Ä–µ–¥–∏
```bash
GET /api/queue/list?limit=50
```

#### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```bash
GET /api/queue/stats
```

–û—Ç–≤–µ—Ç:
```json
{
  "pending": 0,
  "downloading": 1,
  "completed": 10,
  "errors": 2,
  "total": 13,
  "is_running": true,
  "is_paused": false,
  "current_track_id": "68160955"
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü—Ä–æ—Ü–µ—Å—Å–æ–º

#### –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
```bash
POST /api/queue/start
```

#### –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```bash
POST /api/queue/pause
```

#### –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å
```bash
POST /api/queue/resume
```

#### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```bash
POST /api/queue/stop
```

### –û—á–∏—Å—Ç–∫–∞

#### –£–¥–∞–ª–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
```bash
DELETE /api/queue/clear-completed
```

#### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç—Ä–µ–∫
```bash
DELETE /api/queue/track/{track_id}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤–∞—è –°—Ç—Ä–∞–Ω–∏—Ü–∞
–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `file:///tmp/test_new_queue.html`

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∫–ª—é—á–∞–µ—Ç:
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üéÆ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- üìù –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
- üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏
curl -X POST http://localhost:8000/api/queue/add-tracks \
  -H "Content-Type: application/json" \
  -d '{
    "tracks": [
      {"id": "68160955", "title": "Afrika", "artist": "Morandi", "album": "N.O.W."}
    ],
    "quality": "lossless"
  }'

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
curl -X POST http://localhost:8000/api/queue/start

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl http://localhost:8000/api/queue/stats | jq .

# 4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—á–µ—Ä–µ–¥—å
curl http://localhost:8000/api/queue/list | jq '.queue[]'
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### FLAC –ó–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ **Afrika - Morandi**: 31 –ú–ë, FLAC 16bit/44.1kHz
- ‚úÖ **Time - Pink Floyd**: 71 –ú–ë, FLAC 16bit/44.1kHz

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –ü–∞—É–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **DownloadQueueManager** (`backend/download_queue_manager.py`)
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é –∑–∞–≥—Ä—É–∑–æ–∫
   - –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

2. **API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã** (`backend/main.py`)
   - REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

3. **YandexMusicClient** (`backend/yandex_client.py`)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä—è–º—ã–º API –¥–ª—è FLAC
   - –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

4. **–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö**
   - –¢–∞–±–ª–∏—Ü–∞ `download_queue`
   - –ü–æ–ª—è: track_id, title, artist, album, status, progress, quality, file_path, error_message

### Workflow

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç—Ä–µ–∫–∏ ‚Üí pending
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É ‚Üí –≤–æ—Ä–∫–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É
3. –í–æ—Ä–∫–µ—Ä –±–µ—Ä—ë—Ç –ø–µ—Ä–≤—ã–π pending —Ç—Ä–µ–∫ ‚Üí downloading
4. –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª ‚Üí completed
6. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É pending —Ç—Ä–µ–∫—É
7. –ï—Å–ª–∏ –Ω–µ—Ç pending —Ç—Ä–µ–∫–æ–≤ ‚Üí –≤–æ—Ä–∫–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
```

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤

–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
```
{download_path}/{artist}/{album}/{artist} - {title}.{ext}
```

–ü—Ä–∏–º–µ—Ä:
```
/home/urch/Music/Yandex/
  Morandi/
    N.O.W./
      Morandi - Afrika.flac
  Pink Floyd/
    The Dark Side of the Moon/
      Pink Floyd - Time.flac
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### FLAC –ó–∞–≥—Ä—É–∑–∫–∞
1. –ó–∞–ø—Ä–æ—Å –∫ API —Å HMAC –ø–æ–¥–ø–∏—Å—å—é
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ MP4 —Ñ–∞–π–ª–∞
3. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ AES-128-CTR —Å –Ω—É–ª–µ–≤—ã–º —Å—á—ë—Ç—á–∏–∫–æ–º
4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ FLAC —á–µ—Ä–µ–∑ FFmpeg: `ffmpeg -i input.mp4 -c:a copy output.flac`

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `pycryptodome` - –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
- `ffmpeg` - –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- `asyncio` - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Frontend
–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. `PlaylistManager.tsx` - –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å"
2. `DownloadQueue.tsx` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–∞—É–∑—ã/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –£–ª—É—á—à–µ–Ω–∏—è
- [ ] –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏
- [ ] –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ü–æ–≤—Ç–æ—Ä –æ—à–∏–±–æ—á–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
- [ ] –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –æ—á–µ—Ä–µ–¥–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- FLAC —Ñ–∞–π–ª—ã –∑–∞–Ω–∏–º–∞—é—Ç ~30-70 –ú–ë –Ω–∞ —Ç—Ä–µ–∫ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç ~1-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç—Ä–µ–∫
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (403 no-rights)
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

## üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞

**–£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ fallback:**

1. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `quality: lossless`:
   - ‚úÖ –ï—Å–ª–∏ FLAC –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç FLAC
   - ‚úÖ –ï—Å–ª–∏ FLAC –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç **–ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π** —Ñ–æ—Ä–º–∞—Ç (–æ–±—ã—á–Ω–æ MP3 320 kbps)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (`.flac` ‚Üí `.mp3`)

2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   ```
   üîÑ FLAC –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω MP3
   ‚û°Ô∏è  –í—ã–±—Ä–∞–Ω –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π: MP3 (320 kbps)
   üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤: /path/Artist - Track.mp3
   ```

**–í—ã –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ!**

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

1. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 403 (no-rights) - —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API
2. –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π (–ø–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

